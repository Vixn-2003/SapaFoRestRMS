@{
    ViewData["Title"] = "Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n";
    Layout = "~/Views/Shared/_Layout.cshtml";
    int orderId = ViewBag.OrderId ?? 0;
    string apiBaseUrl = ViewBag.ApiBaseUrl as string ?? "https://localhost:7000/api";
}

@section Styles {
    <link rel="stylesheet" href="~/css/payment.css" asp-append-version="true" />
}

<div class="payment-container">
    <div class="breadcrumb-nav">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item">
                    <a href="/Payment/OrderSelection">ƒê∆°n h√†ng</a>
                </li>
                <li class="breadcrumb-item">
                    <a href="/Payment/OrderDetail?id=@orderId">Chi ti·∫øt</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Thanh to√°n</li>
            </ol>
        </nav>
    </div>

    <div class="text-center mb-4">
        <h3 class="mb-2">
            <i class="bi bi-credit-card me-2"></i>Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n
        </h3>
        <p class="text-muted">Vui l√≤ng ch·ªçn h√¨nh th·ª©c thanh to√°n ph√π h·ª£p</p>
    </div>

    <div class="payment-method-grid">
        <!-- Ti·ªÅn m·∫∑t -->
        <div class="payment-method-card" onclick="selectPaymentMethod('cash')">
            <div class="payment-method-icon">üíµ</div>
            <div class="payment-method-name">Ti·ªÅn m·∫∑t</div>
            <div class="payment-method-desc">Thanh to√°n b·∫±ng ti·ªÅn m·∫∑t</div>
        </div>

        <!-- Th·∫ª -->
        <div class="payment-method-card" onclick="selectPaymentMethod('card')">
            <div class="payment-method-icon">üí≥</div>
            <div class="payment-method-name">Th·∫ª</div>
            <div class="payment-method-desc">Th·∫ª t√≠n d·ª•ng / Ghi n·ª£</div>
        </div>

        <!-- V√≠ ƒëi·ªán t·ª≠ -->
        <div class="payment-method-card" onclick="selectPaymentMethod('ewallet')">
            <div class="payment-method-icon">üì±</div>
            <div class="payment-method-name">V√≠ ƒëi·ªán t·ª≠</div>
            <div class="payment-method-desc">MoMo, ZaloPay, VNPay...</div>
        </div>

        <!-- Chia bill -->
        <div class="payment-method-card" onclick="selectPaymentMethod('split')">
            <div class="payment-method-icon">üí∏</div>
            <div class="payment-method-name">Chia bill</div>
            <div class="payment-method-desc">Chia h√≥a ƒë∆°n nhi·ªÅu ng∆∞·ªùi</div>
        </div>
    </div>

    <div class="text-center mt-4">
        <a href="/Payment/OrderDetail?id=@orderId" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-2"></i>Quay l·∫°i
        </a>
    </div>
</div>

<!-- Toast Notification -->
<div class="toast-container">
    <div id="toastNotification" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong class="me-auto">Th√¥ng b√°o</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="toastMessage"></div>
    </div>
</div>

@section Scripts {
    <script>
        const apiBaseUrl = '@apiBaseUrl';
        const orderId = @orderId;
        let selectedMethod = null;

        // Ch·ªçn ph∆∞∆°ng th·ª©c thanh to√°n
        function selectPaymentMethod(method) {
            // Remove active class t·ª´ t·∫•t c·∫£ cards
            document.querySelectorAll('.payment-method-card').forEach(card => {
                card.classList.remove('active');
            });

            // Add active class cho card ƒë∆∞·ª£c ch·ªçn
            event.currentTarget.classList.add('active');
            selectedMethod = method;

            // Chuy·ªÉn ƒë·∫øn m√†n h√¨nh x√°c nh·∫≠n
            setTimeout(() => {
                window.location.href = `/Payment/PaymentConfirmation?orderId=${orderId}&method=${method}`;
            }, 300);
        }

        // Show toast
        function showToast(message, type = 'info') {
            const toast = document.getElementById('toastNotification');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            
            const toastInstance = new bootstrap.Toast(toast);
            toastInstance.show();
        }
    </script>
}

